[TOC]

# 调研报告

——基于互联网网页的小型分布式文件系统

## 项目成员

罗丽薇

邱子悦

袁一玮

余致远

## 项目简介

本项目旨在实现可用性高的基于互联网网页的小型分布式文件系统，在已有的项目的基础上，希望实现多用户权限管理、更高效的文件碎片传输、更低复杂度的备份机制等优化，做出可用性高的“私人网盘”。

参考项目为：

https://github.com/IngramWang/DFS_OSH2017_USTC

## 项目背景

### 分布式文件系统

分布式文件系统（Distributed File System）是指文件系统管理的物理存储资源不直接连接在本地节点上，而是通过计算机网络与节点（可简单的理解为一台计算机）相连。分布式文件系统的设计同样基于客户机/服务器模式：一个典型的网络可能包括多个供用户访问的服务器，但对等特性允许一些系统扮演客户机和服务器的双重角色。用户可以公开一个允许其他客户机访问的目录，一旦被访问，这个目录对客户机来说就像使用本地驱动器一样。

### 使用分布式系统的必要性

中心化服务器能提供连接的带宽服务、数据储存是有限的，集中访问时会出现网络拥堵；中心化的存储服务也有安全隐患。

大数据时代，互联网凸显了以下问题：如何快速且经济地分发数据；如何记录大规模数据的版本迭代；如何有效储存避免丢失重要文件。互联网从Client/Sever的主从结构、到CDN网络分发的小组织结构、到分布式分发网络的变化，体现了单点服务的不足。

### 传统分布式文件系统的局限性

随着社会经济的发展与信息化进程的继续，台式计算机、膝上电脑、智能手机、平板电脑和更多的智能可穿戴设备正疯狂涌入当前的家庭和小微企业。这些设备极大地提高了企业的办公效率、丰富了家庭的娱乐需求，但如何高效地利用分散在这些不同的设备上的存储空间如今正越发成为大家关注的问题：运用好这些分散的存储空间不仅可以方便多人合作办公，更可以避免资源的浪费。 

而家庭和小微企业的存储设备有如下特点：

（1）存储资源小而分散，每个设备的存储容量通常不超过 1TB； 

（2）设备通常只有在使用时才会在线联网，否则处于关闭状态； 

（3）很多设备的位置随时间而变化，故它们常常并不总在其归属网络上； 

（4）和专用的服务器相比，这些设备的性能较低； 

（5）设备没有统一的指令集和操作系统； 

（6）连接设备的网络环境较差，往往通过一般的局域网或互联网相连接。 

面对这些特点，很难用一个集中式的文件系统组织分散在这些不同的设备上的存储空间。

然而，即使是传统的分布式文件系统想在这种环境中应用也是十分困难的，这体现在： 

（1）传统的分布式文件系统往往要求高性能、稳定的服务器，而上述环境中的机器不但性能不足，更不常在线； 

（2）传统的分布式文件系统往往要求服务器具有相同的操作系统甚至是定制的操作系统以方便管理，而上述环境中的机器运行不同的操作系统上； 

同时，各大商业网盘的安全性深受质疑，限速或者收费等限制并不能很好地满足我们对存储的需要。

## 立项依据

面对前述现状，我们希望在前人的试验基础上，实现可用性更高的基于互联网网页的小型分布式文件系统。在上述应用环境中解决文件的分散存储并提供比免费网盘更好的服务。

在我们的设计中，我们将利用所有安装了客户端的机器共享存储空间存储文件碎片，利用一个专用的服务器维持系统的状态并协调各个客户机处理请求，利用互联网网页访问整个文件系统。这样，只要是一个安装了客户端的机器便都可以通过贡献存储空间的方式加入分布式文件系统；只要是一个可以上网、安装了网页浏览器的电脑就都可以访问我们的分布式文件系统。这使得我们的分布式文件系统具备较为便捷的访问方式与利用闲置设备的潜力。

## 前瞻性/重要性分析

本项目在已有项目的基础上，希望做出以下几项核心优化：

### 容器化

xxxxx（交给loli

### 多用户权限管理

出于安全考虑，关键的的功能需限制部分用户的使用；出于方便性考虑，系统功能也需要根据不同的用户而定制，如下图示，多用户权限管理系统十分重要：

<img src="images/1.png" alt="1" style="zoom:50%;" />

而参考项目虽然实现了注册和登录等相关功能，但对于用户的权限并没有作出区分，即均是root权限。这是安全性考虑的欠缺，也是在用户范围扩大后，会损害方便性的弊端。我们有必要做出改变。

### 更高效的文件处理

参考项目对于文件编解码、分割、传输的具体实现如下：

\* 客户端文件分块模块对文件应用 erasure code 算法进行分块

\* 客户端与服务器建立数据连接并将碎片发往服务器

\* 服务器暂存碎片

\* 某客户端与服务器建立数据连接并接收碎片，发送完碎片后服务器将暂存的碎片删除

\* 下载：浏览器端选中文件，服务器收集碎片，解码拼接后，可以下载

而更高效地实现应该是将编解码以及切分文件等工作转移到浏览器端实现。

xxxxx（我又不懂了 这块不太确信自己写的内容的准确性

### token

xxxxx（完全不懂



## 相关工作（科研及工业界）

随着现代社会从工业时代过渡到信息时代，信息技术的发展以及人类生活的智能化带来数据的爆炸性增长，数据正成为世界上最有价值的资源。

根据物理存储形态，数据存储可分为集中式存储与分布式存储两种。集中式存储以传统存储阵列（传统存储）为主，分布式存储（云存储）以软件定义存储为主。

传统存储一向以可靠性高、稳定性好，功能丰富而著称，但与此同时，传统存储也暴露出横向扩展性差、价格昂贵、数据连通困难等不足，容易形成数据孤岛，导致数据中心管理和维护成本居高不下。

分布式存储：将数据分散存储在网络上的多台独立设备上，一般采用标准x86服务器和网络互联，并在其上运行相关存储软件，系统对外作为一个整体提供存储服务。

分布式文件存储，不仅提高了存储空间的利用率，还实现了弹性扩展，降低了运营成本，避免了资源浪费，更适合未来的数据爆炸时代场景。

以下分析典型的分布式文件系统并与我们的设计进行对比。

### Google File System

Google File System（以下简称为GFS）是由Google设计并实现的一个面向大规模数据密集型应用的分布式文件系统，其可以运行在由廉价的硬件设备组成的机群上，为大量客户机提供高性能的服务。 

GFS的设计目标针对Google公司特殊的使用环境进行了优化，与传统的分布式文件系统相比，这主要体现在以下几处不同： 

（1）面向经常失效的组件而设计：GFS由成百上千台廉价设备组成，鉴于这些设备的数量之多与质量之普通，事实上，设备的失效将是一个常态化的问题而非偶发问题。设备失效可能由很多原因造成，如程序的bug、人为失误或设备本身（包括硬盘、内存、网络连接器等）的损坏。无论具体的原因是什么，这意味着GFS必须通过错误侦测、灾难冗余及自动恢复等诸多机制才能提供一个稳定而高性能的服务。 

（2）面向大量的巨型文件而设计：GFS中存储的文件往往非常巨大（约在数GB的量级）且数量众多，这意味着设计时的I/O操作和Block的大小都需要对其进行特别的优化。同时，必要的情况下牺牲处理小文件时的性能也是可以考虑的。 

（3）面向顺序读写而设计：在GFS中，文件的修改基本上都是以在尾部追加数据的方式进行，随机写入的操作几乎不存在；同时，文件写完之后的操作通常只有顺序读取。大量的数据符合这些特性，如：数据分析程序扫描的超大的数据集；正在运行的应用程序生成的连续的数据流；或由一台机器生成、另外一台机器处理的中间数据等。这个特性意味着客户端对数据缓存是没有意义的、对追加操作的性能优化是提高写入性能的主要手段。 

（4）面向协同开发的应用程序而设计：鉴于使用GFS的应用程序也是Google开发的，对于一些在分布式文件系统的设计中比较棘手的问题，可以通过与上层应用的协作来解决。例如，GFS并没有使用严格的一致性模型，而是把这部分的工作交给了具体的应用来解决，这提高了整个系统的灵活性、简化了GFS的设计、减轻了对应用程序的苛刻要求。 

（5）面向大吞吐量应用而设计：GFS的目标程序绝大部分要求能高速率、大批量地处理数据，极少对单一的读写操作有严格的响应时间要求。因此，在GFS的设计中，高速稳定的网络带宽比低延迟更重要。 

### Cooperative File System

Cooperative File System（以下简称CFS）是一个基于P2P机制的分布式文件系统，最早在MIT的一篇硕士论文中提出。CFS采用了完全的去中心化设计，可以在由多达数百万节点组成的系统中提供只读文件服务。 

作为一个基于P2P机制的分布式文件系统，CFS设计时的要点和面对的主要问题与传统的服务器-客户端式的分布式文件系统有很大不同，这主要体现在： 

（1）节点的对称与负载的均衡：相较于专用的服务器，P2P结构中的对等节点处理负载的能力（与意愿）无疑更低，因此，必须更加小心地根据各个节点的状态平衡负载以避免由于少数节点的崩溃影响系统整体的性能。同时，由于没有中心服务器统一收集、处理各个节点的状态，这个工作无疑更加困难。 

（2）节点十分不可靠：在前面的介绍中提到过GFS是*面向经常失效的组件而设计*的，但相比于主要由于硬件损坏导致组件失效的GFS，CFS的节点更迭的速度无疑更快。研究显示，在基于P2P的分布式文件系统中，50%的节点不会连续服务超过60分钟，甚至有25%的节点不会连续服务超过10分钟。因此，CFS必须付出更大的努力解决节点经常失效带来的状态维护及文件丢失等问题。 

（3）可观的通讯次数与延迟：在服务器-客户端体系结构的分布式文件系统中，节点要获取一个文件通常要与名字服务器、数据服务器各进行一次通讯；但CFS没有名字服务器统一地处理请求，因此通常必须与其它的节点直接通讯，在一些结构中，通讯的次数可能和节点的个数在相同量级。当系统中节点数量较多时，这是无法忍受的，因此必须加以优化。 

（4）安全性：在基于P2P机制构建的分布式文件系统中，各个存储节点都来自不同用户的自愿加入，这些用户并不来自同一个组织，也不受共同的管理。因此，这些系统除了要小心地避免由于非同步的写操作导致的不一致（由于CFS是只读的，其不必面对这个问题）外，更要通过加密等手段保证数据不被一些节点恶意地篡改。 

### Interplanetary File System

IPFS（Interplanetary File System）是一个分布式的文件系统和传输协议，整合了分布式DHT、Kademlia、Git和Self-CertifyingFile System四种技术。

IPFS将数据进行分割，形成很多细小的加密碎片，发布到相同网络下的各个节点并保存到IPFS网关上的DHT中，并且用Self-CertifyingFile System自校验，以确保数据的安全和传输的速度。

IPFS很容易抵抗DDoS，它是一个CDN，将所有对网站的访问被分割成对不同节点的访问，攻击者自己都找不到是在攻击哪一个节点，所以IPFS在数据安全性上有它的独特之处。

### Ceph

Ceph文件系统（Ceph FS）是个POSIX兼容的文件系统，它使用Ceph存储集群来存储数据。它的设计包括保护单一点故障的容错功能，它假设大规模（PB级存储）存储故障是常见现象而不是例外情况。

### Hadoop Distributed File System

HDFS（Hadoop Distributed File System），作为Google File System（GFS）的实现，是Hadoop项目的核心子项目，是分布式计算中数据存储管理的基础，是基于流数据模式访问和处理超大文件的需求而开发的，可以运行于廉价的商用服务器上。它所具有的高容错、高可靠性、高可扩展性、高获得性、高吞吐率等特征为海量数据提供了不怕故障的存储，为超大数据集（Large Data Set）的应用处理带来了很多便利。

HDFS特点：

（1）高容错性、可构建在廉价机器上

（2）适合批处理

（3）适合大数据处理：提供高吞吐量的数据访问，非常适合大规模数据集上的应用

（4）流式文件访问：放宽了一部分POSIX约束，来实现流式读取文件系统数据的目的

HDFS局限：

（1）不支持低延迟访问

（2）不适合小文件存储

（3）不支持并发写入

（4）不支持修改

HDFS的结构如图所示：

<img src="images/2.jpeg" alt="2" style="zoom:50%;" />

### Network File System

NFS（Network File System）是最早流行的分布式文件系统，至今已出到第四代，前三代是典型的中心化的文件系统，第四代改成了去中心化结构。

NFS 配有由同一公司开发的 VFS（Virtual File System)接口用于调用文件，客户与服务器通过 RPC（Remote Procedure Call Protocol）——远程过程调用协议进行通讯。

NFS最主要的一个特点是无记忆性（第四代除外），其不会保留任何历史信息和历史请求。若服务器起崩溃，不用再重构它的记录表，仅需重新启动，这大大缩短了恢复系统所需要的时间。但这也将产生不利的因素，客户需要重新修复他们的数据信息，否则可能会和之前的信息不一致。

### 分布式文件系统间的对比

最后来简要对比我们设想的分布式文件系统与上述现有的分布式文件系统的主要异同： 

（1）设计目的：当前包括 GFS、AFS 在内的大多数商业分布式文件系统均是面向大型企业或团体设计的，强调高性能与高可靠，而我们的分布式文件系统均是面向家庭与小微企业，强调低成本与结构简单。 

（2）实现层次：与现有的大多数分布式文件系统相同，我们在客户进程的层次提供服务，和 AFS 相比，我们的分布式文件系统不需要修改操作系统； 

（3）备份方式：我们基于 Erasure code 技术实现数据的备份，这在设备经常离线的系统中可以较 GFS 采用的文件完整的方式大大节省存储空间； 

（4）网络环境：目前，大多数高性能分布式文件系统只支持在局域网上运行，而我们的分布式文件系统可以在互联网上运行。

